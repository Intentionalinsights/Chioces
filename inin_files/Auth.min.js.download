(function(){'use strict';var Auth={'config':{},init:function(){var self=this;self.buildElements();self.attachEvents();self.registerCallbacks();},buildElements:function(){var self=this;},attachEvents:function(){var self=this;self.initLoginEvents();self.initSignUpEvents();},registerCallbacks:function(){var self=this;Base.Controller.registerCallback('auth/login',self.doManualLoginHook,self.doManualLoginCallback);Base.Controller.registerCallback('auth/signup',self.doManualLoginHook,self.doManualLoginCallback);},doManualLoginHook:function(data,button){var self=Base.Auth,errors=false,form,email_el,password_el;if(Base.Controller.activeAction=='auth/login'){form=$('#the_login_form');}
else if(Base.Controller.activeAction=='auth/signup'){form=$('#the_signup_form');}
email_el=$('.login_email',form);password_el=$('.login_password',form);data.email=email_el.val();data.password=password_el.val();if(!data.email){errors=true;Base.Notify.error({'title':'<i class="fa fa-warning"></i>  Please enter your email address.','message':''});}
else if(!Base.Tools.validateEmail(data.email)){errors=true;Base.Notify.error({'title':'<i class="fa fa-warning"></i>  Please enter a valid email address.','message':''});}
if(errors){Base.Tools.shake(email_el.parent(),3,'3px',10);email_el.parent().addClass('has-error');}
if(!data.password){errors=true;Base.Tools.bounce(password_el.parent(),3,'3px',10);password_el.parent().addClass('has-error');Base.Notify.error({'title':'<i class="fa fa-warning"></i>  Please enter your password.','message':''});}
if(Base.Controller.activeAction=='auth/signup'){var sign_up=self.extendedSignUpHook(form,data);data=sign_up.data;errors=errors?errors:sign_up.errors;}
if('post'in data&&!errors){form.attr('method','POST');form.append($('<input />').attr({'name':'redirect_url','value':data.redirect_url,'type':'hidden'}));form.append($('<input />').attr({'name':'action','value':Base.Controller.activeAction,'type':'hidden'}));console.log(data);form.submit();return;}
return errors?false:data;},doManualLoginCallback:function(sent,response,button){var errors='',email_el=$('#login_email'),password_el=$('#login_password'),error_el;email_el.parent().removeClass('has-error');password_el.parent().removeClass('has-error');if(response.success&&response.redirect_url){window.location.href=response.redirect_url;return;}
else if(response.success){window.location.reload();return;}
$.each(response.errors,function(k,v){if(!v){return true;}
if(k=='login_email'){error_el=email_el;}
else if(k=='login_password'){error_el=password_el;}
if(error_el!==undefined){Base.Tools.shake(error_el.parent(),3,'3px',10);error_el.parent().addClass('has-error');}
errors+='<i class="fa fa-caret-right"></i>  '+v+'<br /><hr />';});Base.Notify.error({'title':'Login Error','message':errors});},initLoginEvents:function(){var self=this,form=$('#the_login_form'),submit,inputs;if(!form.length){return;}
submit=$('a[data-action]',form);inputs=$('input',form);inputs.keyup(function(e){if(e.keyCode===13){submit.trigger('click');}});},initSignUpEvents:function(){var self=this,form=$('#the_signup_form'),submit,inputs;if(!form.length){return;}
submit=$('a[data-action]',form);inputs=$('input',form);inputs.keyup(function(e){if(e.keyCode===13){submit.trigger('click');}});},extendedSignUpHook:function(form,data){var self=this,errors=false,firstname_el=$('#the_signup_form #firstname'),lastname_el=$('#the_signup_form #lastname'),zip_el=$('#the_signup_form #zip');data.firstname=firstname_el.val();data.lastname=lastname_el.val();data.zip=zip_el.val();if(!data.firstname){errors=true;Base.Notify.error({'title':'<i class="fa fa-warning"></i>  Please enter your first name.','message':''});Base.Tools.shake(firstname_el.parent(),3,'3px',10);firstname_el.parent().addClass('has-error');}
if(!data.lastname){errors=true;Base.Notify.error({'title':'<i class="fa fa-warning"></i>  Please enter your last name.','message':''});Base.Tools.shake(lastname_el.parent(),3,'3px',10);lastname_el.parent().addClass('has-error');}
data.name=data.firstname+' '+data.lastname;return{'data':data,'errors':errors};}};Base.Auth=Auth;}());$(document).ready(function(){'use strict';Base.Auth.init();});