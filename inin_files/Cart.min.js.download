(function(){'use strict';var Cart={item_count:0,init:function(){var self=this;self.buildElements();self.attachEvents();self.registerCallbacks();},buildElements:function(){var self=this;self.cart_count_pills=$('.cart_count_pill');self.item_count=self.cart_count_pills.length?parseInt($('.cart_count_pill').text()):0;},attachEvents:function(){},registerCallbacks:function(){var self=Base.Cart;Base.Controller.registerCallback('cart/add',self.cartAddHook,self.cartAddCallback);Base.Controller.registerCallback('cart/remove',self.cartRemoveHook,self.cartRemoveCallback);Base.Controller.registerCallback('cart/edit',self.cartEditHook,self.cartEditCallback);Base.Controller.registerCallback('cart/clear',self.cartClearHook,self.cartClearCallback);Base.Controller.registerCallback('cart/donation/add',self.donation.cartAddHook,self.donation.cartAddCallback);Base.Controller.registerCallback('cart/donation/remove',self.donation.cartRemoveHook,self.donation.cartRemoveCallback);Base.Controller.registerCallback('cart/donation/edit',self.donation.cartEditHook,self.donation.cartEditCallback);},cartAddHook:function(data,button){var self=Base.Cart,product_form;data.qty=1;if('form'in data){product_form=$('#'+data.form);var select=product_form.find('select[name=product]'),input=product_form.find('input[name=qty]');data.product=select.length?select.find('option:selected').attr('value'):data.product;data.qty=input.length?input.val():1;}
if(!data.product){Base.Notify.error({title:'Cart Error',message:"Please select a size",size:'large'});return;}
data.btn_html=button.html();button.html('<i class="fa fa-spin fa-spinner"></i>  Adding');return data;},cartRemoveHook:function(data,button){var self=this;return data;},cartEditHook:function(data,button){var self=this;return data;},cartClearHook:function(data,button){var self=this;return data;},cartAddCallback:function(sent,data,button){var self=Base.Cart,success_btn_existing=$('.post-add-checkout-link',button.parent()),success_btn;button.html(data.btn_html);if(!data.success){Notify.error({'title':'Cart Error','message':'Please contact customer support.'});return;}
if(typeof fbq==="function"){fbq('track',"AddToCart");}
self.cart_count_pills.text(data.count);if(success_btn_existing.length){success_btn_existing.fadeOut(500,function(){$(this).fadeIn(500);});return data;}
success_btn=$('<a />').addClass('post-add-checkout-link').attr('href','/store/checkout').html('Success. Checkout <i class="fa fa-chevron-right"></i>').hide();button.after(success_btn);success_btn.fadeIn(500);return data;},cartRemoveCallback:function(sent,data,button){var self=this;if(!data.success){Base.Notify.error({title:'Unknown Error',message:"Sorry. Please contact customer support.",size:'large'});return false;}
self.cart_count_pills.text(data.count);return data;},cartEditCallback:function(sent,data,button){var self=this;if(!data.success){Base.Notify.error({title:'Unknown Error',message:"Sorry. Please contact customer support.",size:'large'});return false;}
self.cart_count_pills.text(data.count);return data;},cartClearCallback:function(sent,data,button){var self=this;return data;},'donation':{cartAddHook:function(data,button){var self=this,amount_input=$('#donation_amount_'+data.benefactor);if(!amount_input.length){Base.Notify.error({title:'Unknown Error',message:"Sorry. Please contact customer support.",size:'large'});return false;}
data.amount=amount_input.val();if(!data.amount){Base.Notify.error({title:'Donation Amount Required',message:"Please enter a donation amount.",size:'large'});return false;}
return data;},cartRemoveHook:function(data,button){var self=this;return data;},cartEditHook:function(data,button){var self=this;return data;},cartAddCallback:function(sent,data,button){var self=this,amount_input_row=$('#donation_amount_'+data.benefactor+'_row');if(!data.success){Base.Notify.error({title:'Unknown Error',message:"Sorry. Please contact customer support.",size:'large'});return false;}
amount_input_row.remove();if(sent.reload){window.location.reload();}
return data;},cartRemoveCallback:function(sent,data,button){var self=this;return data;},cartEditCallback:function(sent,data,button){var self=this;return data;}}};Base.Cart=Cart;}());$(document).ready(function(){'use strict';Base.Cart.init();});